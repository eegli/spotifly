"use strict";(self.webpackChunk_spotifly_website=self.webpackChunk_spotifly_website||[]).push([[205],{1147:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>R,contentTitle:()=>U,default:()=>E,frontMatter:()=>D,metadata:()=>L,toc:()=>P});var n=o(4246),i=o(1670),r=o(1758),s=o(3352),a=o(1230),l=o(1015),c=o(5420),d=o(4669),h=o(3990),p=o(5140),u=o(4591),y=o(7378),f=o(6509);let w=function(e){return e.ImplicitGrantFlow="Implicit Grant Flow",e.AuthCodeFlow="Authorization Code Flow",e}({});function m(e,t){const{type:o,payload:n}=t;switch(o){case"setAuthType":return{...e,authType:n};case"setClientId":return{...e,clientId:n};case"setClientSecret":return{...e,clientSecret:n};case"setRefreshToken":return{...e,refreshToken:n};case"setScopes":{const t="string"==typeof n?[n]:n;return{...e,scopes:t}}case"setError":return{...e,error:n};default:return e}}var x=o(2806),g=o(5731),j=o(2750);const k=e=>{let{message:t}=e;return(0,n.jsx)(r.Z,{py:2,px:1,children:(0,n.jsx)(j.Z,{children:t})})};var v=o(1157),b=o(2133),S=o(872),I=o(132),C=o(3845),T=o(2577),Z=o(9998),z=o(9430);const _=e=>{let{expires:t,accessToken:o,refreshToken:i,scopes:r}=e;const[s,a]=(0,y.useState)(!1),l=(e,t)=>{"clickaway"!==t&&a(!1)},c=e=>{navigator.clipboard.writeText(e),a(!0)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(S.Z,{children:[(0,n.jsx)(I.ZP,{children:(0,n.jsx)(T.Z,{primary:"Expires",secondary:`In ${new Date(t-Date.now()).getMinutes()} minutes (at ${new Date(t).toLocaleTimeString()})`})}),(0,n.jsx)(I.ZP,{children:(0,n.jsx)(T.Z,{primary:"Scopes",secondary:r})}),(0,n.jsx)(C.Z,{onClick:()=>c(o),children:(0,n.jsx)(z.Z,{title:"Click to copy access token",placement:"top",children:(0,n.jsx)(T.Z,{primary:"Access token",secondary:o})})}),i&&(0,n.jsx)(C.Z,{onClick:()=>c(i),children:(0,n.jsx)(z.Z,{title:"Copy refresh token",placement:"top",children:(0,n.jsx)(T.Z,{primary:"Refresh token",primaryTypographyProps:{color:"warning.light"},secondary:i,secondaryTypographyProps:{color:"warning.dark"}})})})]}),(0,n.jsx)(Z.Z,{open:s,autoHideDuration:3e3,onClose:l,message:"Token copied to clipboard",action:(0,n.jsx)(b.Z,{size:"small","aria-label":"close",color:"inherit",onClick:l,children:(0,n.jsx)(v.Z,{fontSize:"small"})})})]})},A="__all_scopes__",F="__no_scopes__",G=()=>{const[e,t]=(0,y.useReducer)(m,{authType:w.ImplicitGrantFlow,clientId:"",clientSecret:"",scopes:["user-library-read"],refreshToken:"",error:""}),o=(e.authType===w.ImplicitGrantFlow||e.authType===w.AuthCodeFlow&&e.clientSecret)&&e.clientId&&e.scopes.length>0,[i,j,v]=(0,f.Z)("token");i&&i.expires<Date.now()&&v(),(0,y.useEffect)((()=>{if(window.opener&&"function"==typeof window.opener.spotifyCallback){const e=window.opener.spotifyCallback,t=window.location.search||window.location.hash.slice(1);e(new URLSearchParams(t))}}),[]);return(0,n.jsxs)(x.C,{children:[(0,n.jsxs)(r.Z,{component:"form",sx:{mt:4,display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"15px 10px","& > *":{width:"100%"},mb:2},children:[(0,n.jsxs)(a.Z,{children:[(0,n.jsx)(l.Z,{children:"Authorization Type"}),(0,n.jsx)(p.Z,{onChange:e=>{const o=e.target.value;t({type:"setAuthType",payload:o})},value:e.authType,label:"Authorization Type",children:["Implicit Grant Flow","Authorization Code Flow"].map((e=>(0,n.jsx)(d.Z,{value:e,children:e},e)))})]}),(0,n.jsxs)(a.Z,{children:[(0,n.jsx)(l.Z,{children:"Scopes"}),(0,n.jsxs)(p.Z,{multiple:!0,value:e.scopes,onChange:e=>{const o=e.target.value.includes(A)?g.g8:e.target.value.includes(F)?[]:e.target.value;t({type:"setScopes",payload:o})},input:(0,n.jsx)(h.Z,{label:"Scopes"}),children:[(0,n.jsx)(d.Z,{value:A,children:"Select all"},A),(0,n.jsx)(d.Z,{value:F,children:"Deselect all"},F),(0,n.jsx)(c.Z,{children:"Authorization Scopes"}),g.g8.map((e=>(0,n.jsx)(d.Z,{value:e,children:e},e)))]})]}),(0,n.jsx)(u.Z,{value:e.clientId,label:"Client ID",onChange:e=>{t({type:"setClientId",payload:e.target.value})}},"id"),"Authorization Code Flow"===e.authType&&(0,n.jsx)(u.Z,{value:e.clientSecret,label:"Client Secret",onChange:e=>{t({type:"setClientSecret",payload:e.target.value})}},"secret")]}),o&&(0,n.jsx)(s.Z,{sx:{mb:2,backgroundColor:"#1db954",color:"#fff"},variant:"contained",onClick:()=>{const o=function(e){let{type:t,clientId:o,scopes:n,redirectUri:i}=e;return"https://accounts.spotify.com/authorize?"+new URLSearchParams({response_type:"Implicit Grant Flow"===t?"token":"code",show_dialog:"true",client_id:encodeURIComponent(o),redirect_uri:i,scope:n.join(" ")}).toString()}({type:e.authType,clientId:e.clientId,scopes:e.scopes,redirectUri:window.location.href}),n=window.open(o,"Login with Spotify","width=500,height=800");window.spotifyCallback=async o=>{let i=o.get("access_token")||"";const r=o.get("code");if(o.get("error")||!r&&!i)t({type:"setError",payload:"Error logging in to Spotify. Did you click &quot;cancel&quot; in the popup?"});else{if(t({type:"setError",payload:""}),r){const{refresh_token:o,access_token:n}=await async function(e){let{clientId:t,clientSecret:o,redirectUri:n,code:i}=e;return fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Authorization:"Basic "+window.btoa(t+":"+o)},body:new URLSearchParams({grant_type:"authorization_code",code:i,redirect_uri:n}).toString()}).then((e=>e.json())).then((e=>e))}({clientId:e.clientId,clientSecret:e.clientSecret,code:r,redirectUri:window.location.href});t({type:"setRefreshToken",payload:o}),i=n}j({accessToken:i,scopes:e.scopes.join(", "),expires:new Date(Date.now()+36e5).getTime()}),n?.close()}}},children:"Login with Spotify"}),e.error?(0,n.jsx)(k,{message:e.error}):i?(0,n.jsx)(_,{...i,refreshToken:e.refreshToken}):null]})},D={title:"Authorization",sidebar_position:2},U=void 0,L={id:"authorization",title:"Authorization",description:"In order to access Spotify's data, you will need a dedicated Spotify application (and, of course, a Spotify account). If you don't have one already, click the link below and create one. It's free!",source:"@site/docs/authorization.mdx",sourceDirName:".",slug:"/authorization",permalink:"/docs/authorization",draft:!1,unlisted:!1,editUrl:"https://github.com/eegli/spotifly/tree/main/website/docs/authorization.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Authorization",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docs/overview"},next:{title:"Command Line",permalink:"/docs/command-line"}},R={},P=[{value:"Supported Grant Flows and Tokens",id:"supported-grant-flows-and-tokens",level:2},{value:"Implicit Grant Flow",id:"implicit-grant-flow",level:3},{value:"Authorization Code Flow",id:"authorization-code-flow",level:3},{value:"Getting an access token",id:"getting-an-access-token",level:2}];function O(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"In order to access Spotify's data, you will need a dedicated Spotify application (and, of course, a Spotify account). If you don't have one already, click the link below and create one. It's free!"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://developer.spotify.com/dashboard/",children:"https://developer.spotify.com/dashboard/"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["After having created your application, click ",(0,n.jsx)(t.em,{children:"edit"})," and add the following two redirect URLs:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"https://spotifly.nougat.dev/docs/authorization"})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"http://localhost:3000"})," (optional)"]}),"\n"]}),"\n",(0,n.jsxs)(t.admonition,{type:"info",children:[(0,n.jsx)(t.p,{children:"Whitelisting the first URL enables you to create both short-lived access and long-lived refresh tokens directly on this page using the helper below."}),(0,n.jsxs)(t.p,{children:["The second URL is needed when you want to generate a long-lived token locally. You don't have to add it in your Spotify application. ",(0,n.jsxs)(t.strong,{children:["It's only needed when you want to use the ",(0,n.jsx)(t.code,{children:"auth-token"})," package"]}),"."]})]}),"\n",(0,n.jsx)(t.h2,{id:"supported-grant-flows-and-tokens",children:"Supported Grant Flows and Tokens"}),"\n",(0,n.jsxs)(t.p,{children:["Spotify implements the ",(0,n.jsx)(t.a,{href:"https://www.rfc-editor.org/rfc/rfc6749",children:"OAuth 2.0 authorization framework"}),". Out of all authorization flows, we're particularly interested in two of them: ",(0,n.jsx)(t.code,{children:"Implicit Grant Flow"})," and ",(0,n.jsx)(t.code,{children:"Authorization Code Flow"}),". Both of these methods eventually let us access user-related data on Spotify. Below is an excerpt from the ",(0,n.jsx)(t.a,{href:"https://developer.spotify.com/documentation/general/guides/authorization/",children:"Spotify documentation"})," (",(0,n.jsx)(t.em,{children:"May 2022"}),")."]}),"\n",(0,n.jsx)(t.h3,{id:"implicit-grant-flow",children:"Implicit Grant Flow"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.em,{children:"The implicit grant flow is carried out on the client side and it does not involve secret keys. Thus, you do not need any server-side code to use it. Access tokens issued are short-lived with no refresh token to extend them when they expire"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"authorization-code-flow",children:"Authorization Code Flow"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"The authorization code flow is suitable for long-running applications (e.g. web and mobile apps) where the user grants permission only once."})}),"\n",(0,n.jsx)(t.p,{children:"In short:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.em,{children:"Authorization Code Flow"})," involves exchanging a client secret. It generates both a short-lived access and long-lived ",(0,n.jsx)(t.em,{children:"refresh"})," token that can be used to independently renew the access token."]}),"\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.em,{children:"Implicit Grant Flow"})," does not include and secrets. It can only be carried out in a browser. The result is a short-lived ",(0,n.jsx)(t.em,{children:"access token"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"getting-an-access-token",children:"Getting an access token"}),"\n",(0,n.jsxs)(t.p,{children:["In order to authenticate with Spotify, most packages need a (short-lived) access token. If you're unsure what you need, ",(0,n.jsx)(t.em,{children:"Implicit Grant"})," is a good start! Tokens obtained from this flow expire after one hour and do not require the exchange of any secrets."]}),"\n",(0,n.jsxs)(t.p,{children:["These short-lived tokens are saved locally in this browser as long as they are valid. If you select the ",(0,n.jsx)(t.em,{children:"Authorization Code Flow"}),", the generated ",(0,n.jsx)(t.strong,{children:"refresh token"})," will ",(0,n.jsx)(t.strong,{children:"not"})," be saved in your browser. Copy it before you leave the page!"]}),"\n",(0,n.jsx)(t.p,{children:"Last but not least, note that all packages that require a token will list what scopes are needed."}),"\n","\n","\n",(0,n.jsx)(G,{})]})}function E(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(O,{...e})}):O(e)}},2806:(e,t,o)=>{o.d(t,{C:()=>d});var n=o(5421),i=o(2905),r=o(5970),s=o(7378),a=o(4246);const l=(0,i.Z)({palette:{mode:"dark",primary:{main:"#90caf9",light:"#b5dcfb",dark:"#6bb8f7"}}}),c=(0,i.Z)({palette:{mode:"light",primary:{main:"#4a44a2",light:"#514bb2",dark:"#433d92"}}}),d=e=>{let{children:t}=e;const{colorMode:o}=(0,n.I)(),i=(0,s.useMemo)((()=>"light"===o?c:l),[o]);return(0,a.jsx)(r.Z,{theme:i,children:t})}},5731:(e,t,o)=>{function n(e){let{base:t,obj:o,multiValueKeys:n=[]}=e;return t.trim()+" "+Object.entries(o).reduce(((e,t)=>{let[o,i]=t;if(!1===i||""===i)return e;if(e+=`--${o} `,!0===i)return e;if(Array.isArray(i)){return e+=(n.includes(o)?`"${i.join(" ")}"`:i[0])+" "}return i.indexOf(" ")>-1&&" "!==i.slice(-1)&&(i=`"${i}"`),e+i+" "}),"").trim()}function i(e,t){const o=e.indexOf(t);return o>-1&&([e[0],e[o]]=[e[o],e[0]]),e}o.d(t,{_F:()=>n,g8:()=>r,p1:()=>i});const r=["ugc-image-upload","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-private","user-read-email","user-follow-modify","user-follow-read","user-library-modify","user-library-read","app-remote-control","user-read-playback-position","user-top-read","user-read-recently-played","playlist-modify-private","playlist-read-collaborative","playlist-read-private","playlist-modify-public"]}}]);