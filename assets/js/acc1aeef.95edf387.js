"use strict";(self.webpackChunk_spotifly_website=self.webpackChunk_spotifly_website||[]).push([[205],{9303:(e,t,o)=>{o.d(t,{C:()=>c});var a=o(4561),n=o(2905),r=o(9703),i=o(7378);const l=(0,n.Z)({palette:{mode:"dark",primary:{main:"#90caf9",light:"#b5dcfb",dark:"#6bb8f7"}}}),s=(0,n.Z)({palette:{mode:"light",primary:{main:"#4a44a2",light:"#514bb2",dark:"#433d92"}}}),c=e=>{let{children:t}=e;const{colorMode:o}=(0,a.I)(),n=(0,i.useMemo)((()=>"light"===o?s:l),[o]);return i.createElement(r.Z,{theme:n},t)}},9057:(e,t,o)=>{function a(e){let{base:t,obj:o,multiValueKeys:a=[]}=e;return t.trim()+" "+Object.entries(o).reduce(((e,t)=>{let[o,n]=t;if(!1===n||""===n)return e;if(e+="--"+o+" ",!0===n)return e;if(Array.isArray(n)){return e+=(a.includes(o)?'"'+n.join(" ")+'"':n[0])+" "}return n.indexOf(" ")>-1&&" "!==n.slice(-1)&&(n='"'+n+'"'),e+n+" "}),"").trim()}function n(e,t){const o=e.indexOf(t);return o>-1&&([e[0],e[o]]=[e[o],e[0]]),e}o.d(t,{_F:()=>a,g8:()=>r,p1:()=>n});const r=["ugc-image-upload","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-private","user-read-email","user-follow-modify","user-follow-read","user-library-modify","user-library-read","app-remote-control","user-read-playback-position","user-top-read","user-read-recently-played","playlist-modify-private","playlist-read-collaborative","playlist-read-private","playlist-modify-public"]},6209:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>R,contentTitle:()=>L,default:()=>O,frontMatter:()=>D,metadata:()=>U,toc:()=>P});var a=o(2685),n=o(7378),r=o(5318),i=o(5310),l=o(8666),s=o(1230),c=o(1015),p=o(5420),d=o(4669),u=o(3990),h=o(719),m=o(4591),y=o(6509);let k;function f(e,t){const{type:o,payload:a}=t;switch(o){case"setAuthType":return{...e,authType:a};case"setClientId":return{...e,clientId:a};case"setClientSecret":return{...e,clientSecret:a};case"setRefreshToken":return{...e,refreshToken:a};case"setScopes":{const t="string"==typeof a?[a]:a;return{...e,scopes:t}}case"setError":return{...e,error:a};default:return e}}!function(e){e.ImplicitGrantFlow="Implicit Grant Flow",e.AuthCodeFlow="Authorization Code Flow"}(k||(k={}));var w=o(9303),g=o(9057),v=o(8389);const b=e=>{let{message:t}=e;return n.createElement(i.Z,{py:2,px:1},n.createElement(v.Z,null,t))};var C=o(4082),E=o(1157),S=o(2133),T=o(872),I=o(132),Z=o(3845),z=o(2577),N=o(1393),x=o(6807);const A=e=>{let{expires:t,accessToken:o,refreshToken:a,scopes:r}=e;const[i,l]=(0,n.useState)(!1),s=(e,t)=>{"clickaway"!==t&&l(!1)},c=e=>{navigator.clipboard.writeText(e),l(!0)};return n.createElement(n.Fragment,null,n.createElement(T.Z,null,n.createElement(I.ZP,null,n.createElement(z.Z,{primary:"Expires",secondary:"In "+new Date(t-Date.now()).getMinutes()+" minutes (at "+new Date(t).toLocaleTimeString()+")"})),n.createElement(I.ZP,null,n.createElement(z.Z,{primary:"Scopes",secondary:r})),n.createElement(Z.Z,{onClick:()=>c(o)},n.createElement(x.Z,{title:"Click to copy access token",placement:"top"},n.createElement(z.Z,{primary:"Access token",secondary:o}))),a&&n.createElement(Z.Z,{onClick:()=>c(a)},n.createElement(x.Z,{title:"Copy refresh token",placement:"top"},n.createElement(z.Z,{primary:"Refresh token",primaryTypographyProps:{color:"warning.light"},secondary:a,secondaryTypographyProps:{color:"warning.dark"}})))),n.createElement(C.Z,null,n.createElement(N.Z,{open:i,autoHideDuration:3e3,onClose:s,message:"Token copied to clipboard",action:n.createElement(S.Z,{size:"small","aria-label":"close",color:"inherit",onClick:s},n.createElement(E.Z,{fontSize:"small"}))})))},_="__all_scopes__",F="__no_scopes__",G=()=>{const[e,t]=(0,n.useReducer)(f,{authType:k.ImplicitGrantFlow,clientId:"",clientSecret:"",scopes:["user-library-read"],refreshToken:"",error:""}),o=(e.authType===k.ImplicitGrantFlow||e.authType===k.AuthCodeFlow&&e.clientSecret)&&e.clientId&&e.scopes.length>0,[r,v,C]=(0,y.Z)("token");r&&r.expires<Date.now()&&C(),(0,n.useEffect)((()=>{if(window.opener&&"function"==typeof window.opener.spotifyCallback){const e=window.opener.spotifyCallback,t=window.location.search||window.location.hash.slice(1);e(new URLSearchParams(t))}}),[]);return n.createElement(w.C,null,n.createElement(i.Z,{component:"form",sx:{mt:4,display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"15px 10px","& > *":{width:"100%"},mb:2}},n.createElement(s.Z,null,n.createElement(c.Z,null,"Authorization Type"),n.createElement(h.Z,{onChange:e=>{const o=e.target.value;t({type:"setAuthType",payload:o})},value:e.authType,label:"Authorization Type"},["Implicit Grant Flow","Authorization Code Flow"].map((e=>n.createElement(d.Z,{key:e,value:e},e))))),n.createElement(s.Z,null,n.createElement(c.Z,null,"Scopes"),n.createElement(h.Z,{multiple:!0,value:e.scopes,onChange:e=>{const o=e.target.value.includes(_)?g.g8:e.target.value.includes(F)?[]:e.target.value;t({type:"setScopes",payload:o})},input:n.createElement(u.Z,{label:"Scopes"})},n.createElement(d.Z,{key:_,value:_},"Select all"),n.createElement(d.Z,{key:F,value:F},"Deselect all"),n.createElement(p.Z,null,"Authorization Scopes"),g.g8.map((e=>n.createElement(d.Z,{key:e,value:e},e))))),n.createElement(m.Z,{value:e.clientId,label:"Client ID",key:"id",onChange:e=>{t({type:"setClientId",payload:e.target.value})}}),"Authorization Code Flow"===e.authType&&n.createElement(m.Z,{value:e.clientSecret,label:"Client Secret",key:"secret",onChange:e=>{t({type:"setClientSecret",payload:e.target.value})}})),o&&n.createElement(l.Z,{sx:{mb:2,backgroundColor:"#1db954",color:"#fff"},variant:"contained",onClick:()=>{const o=function(e){let{type:t,clientId:o,scopes:a,redirectUri:n}=e;return"https://accounts.spotify.com/authorize?"+new URLSearchParams({response_type:"Implicit Grant Flow"===t?"token":"code",show_dialog:"true",client_id:encodeURIComponent(o),redirect_uri:n,scope:a.join(" ")}).toString()}({type:e.authType,clientId:e.clientId,scopes:e.scopes,redirectUri:window.location.href}),a=window.open(o,"Login with Spotify","width=500,height=800");window.spotifyCallback=async o=>{let n=o.get("access_token")||"";const r=o.get("code");if(o.get("error")||!r&&!n)t({type:"setError",payload:"Error logging in to Spotify. Did you click &quot;cancel&quot; in the popup?"});else{if(t({type:"setError",payload:""}),r){const{refresh_token:o,access_token:a}=await async function(e){let{clientId:t,clientSecret:o,redirectUri:a,code:n}=e;return fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Authorization:"Basic "+window.btoa(t+":"+o)},body:new URLSearchParams({grant_type:"authorization_code",code:n,redirect_uri:a}).toString()}).then((e=>e.json())).then((e=>e))}({clientId:e.clientId,clientSecret:e.clientSecret,code:r,redirectUri:window.location.href});t({type:"setRefreshToken",payload:o}),n=a}v({accessToken:n,scopes:e.scopes.join(", "),expires:new Date(Date.now()+36e5).getTime()}),null==a||a.close()}}}},"Login with Spotify"),e.error?n.createElement(b,{message:e.error}):r?n.createElement(A,(0,a.Z)({},r,{refreshToken:e.refreshToken})):null)},D={title:"Authorization",sidebar_position:2},L=void 0,U={unversionedId:"authorization",id:"authorization",title:"Authorization",description:"In order to access Spotify's data, you will need a dedicated Spotify application (and, of course, a Spotify account). If you don't have one already, click the link below and create one. It's free!",source:"@site/docs/authorization.mdx",sourceDirName:".",slug:"/authorization",permalink:"/docs/authorization",draft:!1,editUrl:"https://github.com/eegli/spotifly/tree/main/docs/docs/authorization.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Authorization",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docs/overview"},next:{title:"Command Line",permalink:"/docs/command-line"}},R={},P=[{value:"Supported Grant Flows and Tokens",id:"supported-grant-flows-and-tokens",level:2},{value:"Implicit Grant Flow",id:"implicit-grant-flow",level:3},{value:"Authorization Code Flow",id:"authorization-code-flow",level:3},{value:"Getting an access token",id:"getting-an-access-token",level:2}],M={toc:P};function O(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},M,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In order to access Spotify's data, you will need a dedicated Spotify application (and, of course, a Spotify account). If you don't have one already, click the link below and create one. It's free!"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.spotify.com/dashboard/"},"https://developer.spotify.com/dashboard/"),".")),(0,r.kt)("p",null,"After having created your application, click ",(0,r.kt)("em",{parentName:"p"},"edit")," and add the following two redirect URLs:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"https://spotifly.nougat.dev/docs/authorization")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:3000")," (optional)")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Whitelisting the first URL enables you to create both short-lived access and long-lived refresh tokens directly on this page using the helper below."),(0,r.kt)("p",{parentName:"admonition"},"The second URL is needed when you want to generate a long-lived token locally (",(0,r.kt)("em",{parentName:"p"},"Authorization Code Flow"),"). You don't have to add it in your Spotify application. It's only needed when you want to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth-token")," package.")),(0,r.kt)("h2",{id:"supported-grant-flows-and-tokens"},"Supported Grant Flows and Tokens"),(0,r.kt)("p",null,"Spotify implements the ",(0,r.kt)("a",{parentName:"p",href:"https://www.rfc-editor.org/rfc/rfc6749"},"OAuth 2.0 authorization framework"),". Out of all authorization flows, we're particularly interested in two of them: ",(0,r.kt)("inlineCode",{parentName:"p"},"Implicit Grant Flow")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization Code Flow"),". Both of these methods eventually let us access user-related data on Spotify. Below is an excerpt from the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.spotify.com/documentation/general/guides/authorization/"},"Spotify documentation")," (",(0,r.kt)("em",{parentName:"p"},"May 2022"),")."),(0,r.kt)("h3",{id:"implicit-grant-flow"},"Implicit Grant Flow"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"The implicit grant flow is carried out on the client side and it does not involve secret keys. Thus, you do not need any server-side code to use it. Access tokens issued are short-lived with no refresh token to extend them when they expire"),"."),(0,r.kt)("h3",{id:"authorization-code-flow"},"Authorization Code Flow"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"The authorization code flow is suitable for long-running applications (e.g. web and mobile apps) where the user grants permission only once.")),(0,r.kt)("p",null,"In short:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("em",{parentName:"li"},"Authorization Code Flow")," involves exchanging a client secret. It generates both a short-lived access and long-lived ",(0,r.kt)("em",{parentName:"li"},"refresh")," token that can be used to independently renew the access token."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("em",{parentName:"li"},"Implicit Grant Flow")," does not include and secrets. It can only be carried out in a browser. The result is a short-lived ",(0,r.kt)("em",{parentName:"li"},"access token"),".")),(0,r.kt)("h2",{id:"getting-an-access-token"},"Getting an access token"),(0,r.kt)("p",null,"In order to authenticate with Spotify, most packages need a (short-lived) access token. If you're unsure what you need, ",(0,r.kt)("em",{parentName:"p"},"Implicit Grant")," is a good start! Tokens obtained from this flow expire after one hour and do not require the exchange of any secrets."),(0,r.kt)("p",null,"These short-lived tokens are saved locally in this browser as long as they are valid. If you select the ",(0,r.kt)("em",{parentName:"p"},"Authorization Code Flow"),", the generated ",(0,r.kt)("strong",{parentName:"p"},"refresh token")," will ",(0,r.kt)("strong",{parentName:"p"},"not")," be saved in your browser. Copy it before you leave the page!"),(0,r.kt)("p",null,"Last but not least, note that all packages that require a token will list what scopes are needed."),(0,r.kt)(G,{mdxType:"AuthTokenForm"}))}O.isMDXComponent=!0}}]);